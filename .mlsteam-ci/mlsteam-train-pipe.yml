format: v0.1
name: Yolov9 Setup & Training
vars:
  - name: base_model
    type: string
    label: Base Model
    default: yolov9-c-converted.pt

  - name: data_folder
    type: folder
    label: Data Folder
    default: coco

  - name: train_epoch
    type: string
    label: Training Epoch
    default: '1'

  - name: train_batchsize
    type: string
    label: Batch Size Per Device
    default: '4'

steps:
  - name: checkout code
    type: checkout
    needs: null
    dvc: no
    location: .
  - name: Install required packages and train
    type: docker_run
    needs:
      - checkout code
    image: p9ebc297/yolov9-train:v2
    flavor: medium
    folders:
      - ${data_folder}:/mlsteam/data/coco
    run: |
      # cd src && pip install mlflow  &&  ls -a /usr/local/lib/python3.9/dist-packages
      export WANDB_DISABLED=true 
      # pip install mlflow bentoml
      #pip install -r requirements.txt
      #pip uninstall -y opencv-python
      #pip install opencv-python-headless==4.5.5.64
      python train_dual.py --workers 1 --device 0 --batch-size ${train_batchsize} --epochs ${train_epoch} --data data/coco.yaml \
          --img 640 --cfg models/detect/yolov9-c.yaml --weights ${base_model} \
          --name yolov9-custom --hyp hyp.scratch-high.yaml \
          --min-items 0 --close-mosaic 15
